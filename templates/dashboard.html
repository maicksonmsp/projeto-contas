{% extends "base.html" %}

{% block title %}Dashboard - PEIXOTO GRUPO EMPRESARIAL{% endblock %}

{% block content %}
<style>
    .dashboard-header {
        margin-bottom: 2rem;
    }
    
    .dashboard-title {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 0.25rem;
    }
    
    .dashboard-subtitle {
        color: var(--primary-muted);
        font-size: 0.875rem;
    }
    
    /* CARDS SIMPLES E ELEGANTES */
    .stat-card {
        background: white;
        border: 1px solid var(--primary-border);
        border-radius: 8px;
        padding: 1.25rem;
        transition: all 0.2s;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .stat-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
    }
    
    .stat-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    
    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: white;
        flex-shrink: 0;
    }
    
    .stat-badge {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(4px);
    }
    
    .stat-content {
        flex: 1;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 0.25rem;
        line-height: 1;
    }
    
    .stat-label {
        font-size: 0.875rem;
        color: var(--primary-muted);
        font-weight: 500;
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .stat-detail {
        font-size: 0.8125rem;
        color: var(--primary-muted);
        line-height: 1.5;
        margin-top: auto;
    }
    
    .stat-metric {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .stat-metric:last-child {
        border-bottom: none;
    }
    
    .metric-label {
        font-size: 0.8125rem;
        color: var(--primary-muted);
    }
    
    .metric-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--primary);
    }
    
    /* VISUALIZAÇÃO SIMPLES SEM GRÁFICOS */
    .data-card {
        background: white;
        border: 1px solid var(--primary-border);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        height: 380px;
        display: flex;
        flex-direction: column;
    }
    
    .data-card-header {
        margin-bottom: 1.5rem;
        flex-shrink: 0;
    }
    
    .data-card-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.25rem;
    }
    
    .data-card-subtitle {
        font-size: 0.8125rem;
        color: var(--primary-muted);
    }
    
    .data-list {
        flex: 1;
        overflow-y: auto;
        padding-right: 0.5rem;
    }
    
    .data-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        gap: 1rem;
    }
    
    .data-item:last-child {
        border-bottom: none;
    }
    
    .data-info {
        flex: 1;
        min-width: 0;
    }
    
    .data-label-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.25rem;
    }
    
    .data-label {
        font-size: 0.875rem;
        color: var(--primary);
        font-weight: 500;
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding-right: 1rem;
    }
    
    .data-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--primary);
        white-space: nowrap;
    }
    
    .data-percentage {
        font-size: 0.75rem;
        color: var(--primary-muted);
        margin-left: 0.5rem;
        white-space: nowrap;
    }
    
    .progress-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .progress-bar {
        flex: 1;
        height: 6px;
        background: rgba(0, 0, 0, 0.05);
        border-radius: 3px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
    }
    
    /* CORES DAS BARRAS DE PROGRESSO */
    .progress-blue {
        background: linear-gradient(90deg, #0ea5e9, #3b82f6);
    }
    
    .progress-green {
        background: linear-gradient(90deg, #059669, #10b981);
    }
    
    /* AÇÕES RÁPIDAS */
    .quick-actions .btn {
        border: 1px solid var(--primary-border);
        border-radius: 8px;
        padding: 1rem;
        transition: all 0.2s;
    }
    
    .quick-actions .btn:hover {
        border-color: var(--primary);
        background: var(--gray-50);
    }
    
    /* BADGE PARA CONTAGEM DE ITENS */
    .items-count {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
        color: var(--primary-muted);
        background: rgba(0, 0, 0, 0.03);
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        margin-left: 0.5rem;
    }
    
    /* ESTILOS ESPECÍFICOS PARA CARDS DE STATUS */
    .status-metrics {
        background: rgba(0, 0, 0, 0.02);
        border-radius: 6px;
        padding: 0.75rem;
        margin-top: 0.5rem;
    }
    
    .cost-breakdown {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    
    .cost-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.4rem 0;
        border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
    }
    
    .cost-item:last-child {
        border-bottom: none;
    }
    
    .cost-label {
        font-size: 0.8125rem;
        color: var(--primary-muted);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .cost-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .cost-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--primary);
    }
    
    @media (max-width: 768px) {
        .stat-card {
            padding: 1rem;
        }
        
        .stat-value {
            font-size: 1.75rem;
        }
        
        .data-card {
            height: 350px;
            padding: 1.25rem;
        }
        
        .data-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .progress-container {
            width: 100%;
        }
    }
</style>

<div class="container-fluid">
    <!-- CABEÇALHO -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">Dashboard</h1>
        <p class="dashboard-subtitle">Visão geral do sistema</p>
    </div>

    <!-- CARDS DE ESTATÍSTICAS -->
    <div class="row mb-4">
        <!-- Total de Linhas -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon bg-primary">
                        <i class="bi bi-phone"></i>
                    </div>
                    <div class="stat-badge bg-primary">Total</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ resumo.total_linhas }}</div>
                    <div class="stat-label">Total de Linhas</div>
                    <div class="stat-detail">
                        <div class="status-metrics">
                            <div class="stat-metric">
                                <div class="metric-label">Ativas</div>
                                <div class="metric-value text-success">{{ resumo.linhas_ativas }}</div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">A Cancelar</div>
                                <div class="metric-value text-warning">{{ resumo.linhas_a_cancelar }}</div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">Canceladas</div>
                                <div class="metric-value text-danger">{{ resumo.linhas_canceladas }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Linhas Ativas -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #059669;">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(5, 150, 105, 0.2); color: #059669;">Status</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ resumo.linhas_ativas }}</div>
                    <div class="stat-label">Linhas Ativas</div>
                    <div class="stat-detail">
                        {% if resumo.total_linhas > 0 %}
                            {% set porcentagem_ativas = (resumo.linhas_ativas|float / resumo.total_linhas|float * 100)|round(1) %}
                            {{ porcentagem_ativas }}% do total de linhas
                        {% endif %}
                        <div class="status-metrics">
                            <div class="stat-metric">
                                <div class="metric-label">Custo Total</div>
                                <div class="metric-value">
                                    {% if resumo.custo_linhas_ativas %}
                                        R$ {{ resumo.custo_linhas_ativas|format_currency }}
                                    {% else %}
                                        {% set custo_ativo = (resumo.custo_mensal_total|default(0)|float * resumo.linhas_ativas|float / resumo.total_linhas|float) %}
                                        R$ {{ custo_ativo|format_currency }}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">Média por Linha</div>
                                <div class="metric-value">
                                    {% if resumo.linhas_ativas > 0 %}
                                        {% if resumo.custo_linhas_ativas %}
                                            {% set media_ativo = resumo.custo_linhas_ativas|float / resumo.linhas_ativas|float %}
                                            R$ {{ media_ativo|format_currency }}
                                        {% else %}
                                            {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                                {% set media_ativo = (resumo.custo_mensal_total|float / resumo.total_linhas|float) %}
                                                R$ {{ media_ativo|format_currency }}
                                            {% else %}
                                                R$ 0,00
                                            {% endif %}
                                        {% endif %}
                                    {% else %}
                                        R$ 0,00
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Linhas A Cancelar -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #d97706;">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(217, 119, 6, 0.2); color: #d97706;">Status</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ resumo.linhas_a_cancelar }}</div>
                    <div class="stat-label">Linhas A Cancelar</div>
                    <div class="stat-detail">
                        {% if resumo.total_linhas > 0 %}
                            {% set porcentagem_a_cancelar = (resumo.linhas_a_cancelar|float / resumo.total_linhas|float * 100)|round(1) %}
                            {{ porcentagem_a_cancelar }}% do total de linhas
                        {% endif %}
                        <div class="status-metrics">
                            <div class="stat-metric">
                                <div class="metric-label">Custo Total</div>
                                <div class="metric-value">
                                    {% if resumo.custo_linhas_a_cancelar %}
                                        R$ {{ resumo.custo_linhas_a_cancelar|format_currency }}
                                    {% else %}
                                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                            {% set custo_a_cancelar = (resumo.custo_mensal_total|float * resumo.linhas_a_cancelar|float / resumo.total_linhas|float) %}
                                            R$ {{ custo_a_cancelar|format_currency }}
                                        {% else %}
                                            R$ 0,00
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">Economia Potencial</div>
                                <div class="metric-value text-success">
                                    {% if resumo.custo_linhas_a_cancelar %}
                                        R$ {{ resumo.custo_linhas_a_cancelar|format_currency }}
                                    {% else %}
                                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                            {% set custo_a_cancelar = (resumo.custo_mensal_total|float * resumo.linhas_a_cancelar|float / resumo.total_linhas|float) %}
                                            R$ {{ custo_a_cancelar|format_currency }}
                                        {% else %}
                                            R$ 0,00
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Linhas Canceladas -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #dc2626;">
                        <i class="bi bi-x-circle"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(220, 38, 38, 0.2); color: #dc2626;">Status</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ resumo.linhas_canceladas }}</div>
                    <div class="stat-label">Linhas Canceladas</div>
                    <div class="stat-detail">
                        {% if resumo.total_linhas > 0 %}
                            {% set porcentagem_canceladas = (resumo.linhas_canceladas|float / resumo.total_linhas|float * 100)|round(1) %}
                            {{ porcentagem_canceladas }}% do total de linhas
                        {% endif %}
                        <div class="status-metrics">
                            <div class="stat-metric">
                                <div class="metric-label">Custo Anterior</div>
                                <div class="metric-value">
                                    {% if resumo.custo_linhas_canceladas %}
                                        R$ {{ resumo.custo_linhas_canceladas|format_currency }}
                                    {% else %}
                                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                            {% set custo_canceladas = (resumo.custo_mensal_total|float * resumo.linhas_canceladas|float / resumo.total_linhas|float) %}
                                            R$ {{ custo_canceladas|format_currency }}
                                        {% else %}
                                            R$ 0,00
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">Economia Mensal</div>
                                <div class="metric-value text-success">
                                    {% if resumo.custo_linhas_canceladas %}
                                        R$ {{ resumo.custo_linhas_canceladas|format_currency }}
                                    {% else %}
                                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                            {% set custo_canceladas = (resumo.custo_mensal_total|float * resumo.linhas_canceladas|float / resumo.total_linhas|float) %}
                                            R$ {{ custo_canceladas|format_currency }}
                                        {% else %}
                                            R$ 0,00
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SEGUNDA LINHA DE CARDS -->
    <div class="row mb-4">
        <!-- Departamentos -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #0ea5e9;">
                        <i class="bi bi-building"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(14, 165, 233, 0.2); color: #0ea5e9;">Total</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ departamentos|length }}</div>
                    <div class="stat-label">Departamentos</div>
                    <div class="stat-detail">
                        Com linhas cadastradas
                        <div class="status-metrics">
                            <div class="stat-metric">
                                <div class="metric-label">Total de Departamentos</div>
                                <div class="metric-value">
                                    {{ departamentos|length }}
                                </div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">Média linhas/depto</div>
                                <div class="metric-value">
                                    {% if departamentos|length > 0 %}
                                        {% set media_dept = (resumo.total_linhas|float / departamentos|length|float)|round(1) %}
                                        {{ media_dept }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #8b5cf6;">
                        <i class="bi bi-pie-chart"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">Categorias</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">
                        {% if status_linhas and status_linhas[0] is not string %}
                            {{ status_linhas|length }}
                        {% else %}
                            3
                        {% endif %}
                    </div>
                    <div class="stat-label">Status</div>
                    <div class="stat-detail">
                        Categorias diferentes de status
                        <div class="status-metrics">
                            {% if status_linhas and status_linhas[0] is not string %}
                                {% for status in status_linhas %}
                                <div class="stat-metric">
                                    <div class="metric-label">
                                        {% if status[0] is defined %}
                                            {{ status[0] }}
                                        {% elif status.status is defined %}
                                            {{ status.status }}
                                        {% elif status.nome is defined %}
                                            {{ status.nome }}
                                        {% else %}
                                            Status {{ loop.index }}
                                        {% endif %}
                                    </div>
                                    <div class="metric-value">
                                        {% if status[1] is defined %}
                                            {{ status[1] }}
                                        {% elif status.total is defined %}
                                            {{ status.total }}
                                        {% elif status.quantidade is defined %}
                                            {{ status.quantidade }}
                                        {% elif status.count is defined %}
                                            {{ status.count }}
                                        {% else %}
                                            ?
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="stat-metric">
                                    <div class="metric-label">Ativa</div>
                                    <div class="metric-value">{{ resumo.linhas_ativas }}</div>
                                </div>
                                <div class="stat-metric">
                                    <div class="metric-label">A Cancelar</div>
                                    <div class="metric-value">{{ resumo.linhas_a_cancelar }}</div>
                                </div>
                                <div class="stat-metric">
                                    <div class="metric-label">Cancelada</div>
                                    <div class="metric-value">{{ resumo.linhas_canceladas }}</div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custo Mensal -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #f97316;">
                        <i class="bi bi-cash-stack"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(249, 115, 22, 0.2); color: #f97316;">Mensal</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">
                        {% if resumo.custo_linhas_ativas and resumo.custo_linhas_a_cancelar %}
                            {% set custo_total_ativas_cancelar = resumo.custo_linhas_ativas|float + resumo.custo_linhas_a_cancelar|float %}
                            R$ {{ custo_total_ativas_cancelar|format_currency }}
                        {% elif resumo.custo_mensal_total %}
                            R$ {{ resumo.custo_mensal_total|format_currency }}
                        {% else %}
                            R$ 0,00
                        {% endif %}
                    </div>
                    <div class="stat-label">Custo Mensal</div>
                    <div class="stat-detail">
                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                            {% set media_geral = resumo.custo_mensal_total|float / resumo.total_linhas|float %}
                            Média: R$ {{ media_geral|format_currency }} por linha
                        {% endif %}
                        <div class="cost-breakdown">
                            <div class="cost-item">
                                <div class="cost-label">
                                    <div class="cost-dot" style="background: #059669;"></div>
                                    <span>Linhas Ativas</span>
                                </div>
                                <div class="cost-value">
                                    {% if resumo.custo_linhas_ativas %}
                                        R$ {{ resumo.custo_linhas_ativas|format_currency }}
                                    {% else %}
                                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                            {% set custo_ativo = (resumo.custo_mensal_total|float * resumo.linhas_ativas|float / resumo.total_linhas|float) %}
                                            R$ {{ custo_ativo|format_currency }}
                                        {% else %}
                                            R$ 0,00
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label">
                                    <div class="cost-dot" style="background: #d97706;"></div>
                                    <span>Linhas A Cancelar</span>
                                </div>
                                <div class="cost-value">
                                    {% if resumo.custo_linhas_a_cancelar %}
                                        R$ {{ resumo.custo_linhas_a_cancelar|format_currency }}
                                    {% else %}
                                        {% if resumo.custo_mensal_total and resumo.total_linhas > 0 %}
                                            {% set custo_a_cancelar = (resumo.custo_mensal_total|float * resumo.linhas_a_cancelar|float / resumo.total_linhas|float) %}
                                            R$ {{ custo_a_cancelar|format_currency }}
                                        {% else %}
                                            R$ 0,00
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label">
                                    <div class="cost-dot" style="background: #dc2626;"></div>
                                    <span>Total</span>
                                </div>
                                <div class="cost-value">
                                    {% if resumo.custo_linhas_ativas and resumo.custo_linhas_a_cancelar %}
                                        {% set custo_total_ativas_cancelar = resumo.custo_linhas_ativas|float + resumo.custo_linhas_a_cancelar|float %}
                                        R$ {{ custo_total_ativas_cancelar|format_currency }}
                                    {% elif resumo.custo_mensal_total %}
                                        R$ {{ resumo.custo_mensal_total|format_currency }}
                                    {% else %}
                                        R$ 0,00
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>      

        <!-- Usuário -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-icon" style="background: #14b8a6;">
                        <i class="bi bi-person-circle"></i>
                    </div>
                    <div class="stat-badge" style="background: rgba(20, 184, 166, 0.2); color: #14b8a6;">Ativo</div>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ current_user.nome.split(' ')[0] }}</div>
                    <div class="stat-label">Usuário</div>
                    <div class="stat-detail">
                        Sessão ativa
                        <div class="status-metrics">
                            <div class="stat-metric">
                                <div class="metric-label">Perfil</div>
                                <div class="metric-value">
                                    {% if current_user.isAdmin %}
                                        Administrador
                                    {% else %}
                                        Usuário
                                    {% endif %}
                                </div>
                            </div>
                            <div class="stat-metric">
                                <div class="metric-label">Acesso</div>
                                <div class="metric-value">
                                    {{ "Total" if current_user.isAdmin else "Limitado" }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VISUALIZAÇÃO SIMPLES DOS DADOS -->
    <div class="row mb-4">
        <!-- LISTA 1: LINHAS POR DEPARTAMENTO -->
        <div class="col-lg-6 mb-4">
            <div class="data-card">
                <div class="data-card-header">
                    <div class="data-card-title">
                        <i class="bi bi-building"></i>
                        Linhas por Departamento
                        <span class="items-count">
                            <i class="bi bi-list-ul"></i>
                            {{ departamentos|length }} departamentos
                        </span>
                    </div>
                    <div class="data-card-subtitle">
                        Quantidade de linhas por departamento (ordenado)
                    </div>
                </div>
                <div class="data-list">
                    {% if departamentos and departamentos[0] is not string %}
                        {% set total_linhas_dep = resumo.total_linhas|float %}
                        {% for dept in departamentos|sort(attribute='total', reverse=true) %}
                        <div class="data-item">
                            <div class="data-info">
                                <div class="data-label-row">
                                    <div class="data-label" title="{{ dept.departamento or dept.nome or 'Sem departamento' }}">
                                        {{ dept.departamento or dept.nome or 'Sem departamento' }}
                                    </div>
                                    <div class="data-value">
                                        {% set dept_total = dept.total|default(0)|float %}
                                        {{ dept_total|int }}
                                        <span class="data-percentage">
                                            {% if total_linhas_dep > 0 %}
                                                {{ (dept_total / total_linhas_dep * 100)|round(1) }}%
                                            {% else %}
                                                0%
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill progress-blue" 
                                             style="width: {% if total_linhas_dep > 0 %}{{ (dept_total / total_linhas_dep * 100) }}{% else %}0{% endif %}%;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-building-slash fs-4 mb-3"></i>
                            <p>Nenhum departamento encontrado</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- LISTA 2: CUSTO POR DEPARTAMENTO -->
        <div class="col-lg-6 mb-4">
            <div class="data-card">
                <div class="data-card-header">
                    <div class="data-card-title">
                        <i class="bi bi-cash-coin"></i>
                        Custo por Departamento (R$)
                        <span class="items-count">
                            <i class="bi bi-cash-stack"></i>
                            Total: R$ {{ resumo.custo_mensal_total|format_currency }}
                        </span>
                    </div>
                    <div class="data-card-subtitle">
                        Custo mensal por departamento
                    </div>
                </div>
                <div class="data-list">
                    {% if departamentos and departamentos[0] is not string %}
                        {% set custo_total_geral = resumo.custo_mensal_total|float %}
                        {% for dept in departamentos|sort(attribute='custo_total', reverse=true) %}
                        <div class="data-item">
                            <div class="data-info">
                                <div class="data-label-row">
                                    <div class="data-label" title="{{ dept.departamento or dept.nome or 'Sem departamento' }}">
                                        {{ dept.departamento or dept.nome or 'Sem departamento' }}
                                    </div>
                                    <div class="data-value">
                                        {% set dept_custo = dept.custo_total|default(0)|float %}
                                        R$ {{ dept_custo|format_currency }}
                                        <span class="data-percentage">
                                            {% if custo_total_geral > 0 %}
                                                {{ (dept_custo / custo_total_geral * 100)|round(1) }}%
                                            {% else %}
                                                0%
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill progress-green" 
                                             style="width: {% if custo_total_geral > 0 %}{{ (dept_custo / custo_total_geral * 100) }}{% else %}0{% endif %}%;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-cash-slash fs-4 mb-3"></i>
                            <p>Nenhum custo por departamento encontrado</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- AÇÕES RÁPIDAS -->
    <div class="row">
        <div class="col-12">
            <h6 class="mb-3" style="color: var(--primary); font-weight: 600;">
                <i class="bi bi-lightning me-2"></i>Ações Rápidas
            </h6>
            
            <div class="row quick-actions">
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{{ url_for('adicionar_linha') }}" class="btn btn-light w-100 d-flex flex-column align-items-center">
                        <i class="bi bi-plus-circle fs-4 mb-2" style="color: var(--primary);"></i>
                        <span style="font-size: 0.875rem;">Nova Linha</span>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{{ url_for('listar_linhas') }}" class="btn btn-light w-100 d-flex flex-column align-items-center">
                        <i class="bi bi-list-ul fs-4 mb-2" style="color: var(--primary);"></i>
                        <span style="font-size: 0.875rem;">Listar Linhas</span>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <a href="{{ url_for('exportar_linhas') }}" class="btn btn-light w-100 d-flex flex-column align-items-center">
                        <i class="bi bi-download fs-4 mb-2" style="color: var(--primary);"></i>
                        <span style="font-size: 0.875rem;">Exportar Dados</span>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    {% if current_user.isAdmin %}
                    <a href="{{ url_for('listar_usuarios') }}" class="btn btn-light w-100 d-flex flex-column align-items-center">
                        <i class="bi bi-people fs-4 mb-2" style="color: var(--primary);"></i>
                        <span style="font-size: 0.875rem;">Usuários</span>
                    </a>
                    {% else %}
                    <a href="#" class="btn btn-light w-100 d-flex flex-column align-items-center">
                        <i class="bi bi-person fs-4 mb-2" style="color: var(--primary);"></i>
                        <span style="font-size: 0.875rem;">Perfil</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}